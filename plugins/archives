package archives;
use strict;
use warnings;

our $on = 0;
our $last_yr = 0;

sub start {
    if ($blosxom::path_info eq 'archives') {
        no warnings 'redefine';
        my $orig = $blosxom::template;

        $blosxom::template = sub {
            my ($path, $chunk, $flavour) = @_;

            if ($flavour eq 'html' and $chunk eq 'date' || $chunk eq 'story') {
                $chunk = 'archives_' . $chunk;
            }

            my $template = $orig->($path, $chunk, $flavour);
        };

        return $on = 1;
    };
}

# update last_yr, story hook called just after date interpolat
sub story {
    $last_yr = $blosxom::yr;
}

1;

